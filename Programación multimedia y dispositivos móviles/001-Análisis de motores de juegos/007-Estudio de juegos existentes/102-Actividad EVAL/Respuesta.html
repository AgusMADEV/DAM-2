<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Personaje Isom茅trico - Soluci贸n Completa</title>
    <style>
      body {
        margin: 0;
        padding: 20px;
        font-family: Arial, sans-serif;
        background-color: #f0f0f0;
      }
      #lienzo {
        border: 2px solid #333;
        background-color: white;
        display: block;
        margin: 0 auto;
      }
      .instrucciones {
        max-width: 1024px;
        margin: 10px auto;
        padding: 8px 12px;
        background-color: white;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      }
      h2 {
        margin: 0 0 5px 0;
        color: #333;
        font-size: 16px;
      }
      .instrucciones p {
        margin: 5px 0;
        font-size: 13px;
      }
      .teclas {
        display: inline-block;
        padding: 3px 8px;
        margin: 1px;
        background-color: #4CAF50;
        color: white;
        border-radius: 3px;
        font-weight: bold;
        font-size: 12px;
      }
      .info {
        text-align: center;
        margin: 5px auto;
        max-width: 1024px;
        padding: 5px;
        background-color: #e8f5e9;
        border-radius: 5px;
        font-size: 13px;
      }
    </style>
  </head>
  <body>
    <div class="instrucciones">
      <h2> Control del Personaje</h2>
      <p>Usa las teclas para mover al personaje por la rejilla isom茅trica:</p>
      <p>
        <span class="teclas">W</span> Arriba | 
        <span class="teclas">A</span> Izquierda | 
        <span class="teclas">S</span> Abajo | 
        <span class="teclas">D</span> Derecha
      </p>
    </div>

    <div class="info" id="posicion">
      Posici贸n: (10, 10)
    </div>

    <canvas id="lienzo"></canvas>

    <script>
      // ============================================
      // PASO 1: CONFIGURACIN INICIAL
      // ============================================
      var lienzo = document.querySelector("#lienzo")
      var contexto = lienzo.getContext("2d")
      lienzo.width = 1024
      lienzo.height = 1024
      
      
      // ============================================
      // PASO 2: VARIABLES GLOBALES
      // ============================================
      var paso = 20  // Tama帽o de cada celda de la rejilla
      
      
      // ============================================
      // PASO 3: FUNCIN DE PROYECCIN ISOMTRICA
      // ============================================
      function iso(i, j){
        return {
          x: 512 + (i - j) * paso,
          y: 512 + (i + j) * (paso / 2)
        }
      }
      
      
      // ============================================
      // PASO 4: FUNCIN PARA DIBUJAR LA REJILLA
      // ============================================
      function dibujoRejilla(){
        // Limpio fondo
        contexto.fillStyle = "#fff"
        contexto.fillRect(0, 0, 1024, 1024)
        contexto.strokeStyle = "#d0d0d0"

        // L铆neas paralelas al eje U (j variable, i constante)
        for (let i = -60; i <= 60; i++) {
          const a = iso(i, -60);
          const b = iso(i,  60);
          contexto.beginPath();
          contexto.moveTo(a.x, a.y);
          contexto.lineTo(b.x, b.y);
          contexto.stroke();
        }

        // L铆neas paralelas al eje V (i variable, j constante)
        for (let j = -60; j <= 60; j++) {
          const a = iso(-60, j);
          const b = iso( 60, j);
          contexto.beginPath();
          contexto.moveTo(a.x, a.y);
          contexto.lineTo(b.x, b.y);
          contexto.stroke();
        }
      }
      
      
      // ============================================
      // CLASE RECOGIBLE
      // ============================================
      class Recogible{
        constructor(){
          this.x = Math.round((Math.random() * 120) - 60); // [-60, 60]
          this.y = Math.round((Math.random() * 120) - 60); // [-60, 60]
        }
        dibuja(){
          let puntoiso = iso(this.x, this.y)
          contexto.beginPath();
          contexto.arc(puntoiso.x, puntoiso.y, 8, 0, Math.PI * 2)
          contexto.fillStyle = "green"
          contexto.fill()
        }
      }
      
      // ============================================
      // DESAFO: FUNCIN DE DISTANCIA
      // ============================================
      function distancia(x1, y1, x2, y2) {
        const dx = x2 - x1;
        const dy = y2 - y1;
        return Math.sqrt(dx * dx + dy * dy);
      }
      
      // ============================================
      // PASO 5: CLASE PERSONAJE
      // ============================================
      class Personaje{
        constructor(){
          this.x = 10;
          this.y = 10;
          this.puntos = 0;
        }
        dibuja(){
          let puntoiso = iso(this.x, this.y)
          contexto.beginPath()
          contexto.arc(puntoiso.x, puntoiso.y, 5, 0, Math.PI * 2)
          contexto.fillStyle = "red"
          contexto.fill()
        }
      }
      
      
      // ============================================
      // PASO 6: CREAR INSTANCIA DEL PERSONAJE
      // ============================================
      var Personaje1 = new Personaje();
      
      // ============================================
      // DESAFO: CREAR OBJETOS RECOGIBLES
      // ============================================
      var recogibles = []
      var numeroRecogibles = 20;
      for(let i = 0; i < numeroRecogibles; i++){
        recogibles.push(new Recogible())
      }
      
      
      // ============================================
      // PASO 7: CONTROL DE TECLADO
      // ============================================
      document.onkeydown = function(event){
        // Guardamos la posici贸n anterior para validar
        let nuevoX = Personaje1.x;
        let nuevoY = Personaje1.y;
        
        switch(event.key){
          case "w":
          case "W":
            nuevoX--;
            break;
          case "s":
          case "S":
            nuevoX++;
            break;
          case "a":
          case "A":
            nuevoY++;
            break;
          case "d":
          case "D":
            nuevoY--;
            break;
        }
        
        // PASO 8: RESTRICCIONES - Validar l铆mites
        if(nuevoX >= -60 && nuevoX <= 60){
          Personaje1.x = nuevoX;
        }
        if(nuevoY >= -60 && nuevoY <= 60){
          Personaje1.y = nuevoY;
        }
        
        // DESAFO: Detectar colisiones con recogibles
        for(let i = recogibles.length - 1; i >= 0; i--){
          if(distancia(Personaje1.x, Personaje1.y, recogibles[i].x, recogibles[i].y) < 2){
            recogibles.splice(i, 1)
            Personaje1.puntos++
          }
        }
        
        // Actualizar visualizaci贸n de posici贸n y puntos
        document.getElementById("posicion").textContent = 
          "Posici贸n: (" + Personaje1.x + ", " + Personaje1.y + ") | Objetos recogidos: " + Personaje1.puntos + "/" + numeroRecogibles;
        
        // Redibujar todo
        dibujoRejilla()
        
        // Dibujar recogibles
        for(let i = 0; i < recogibles.length; i++){
          recogibles[i].dibuja()
        }
        
        Personaje1.dibuja()
      }
      
      
      // ============================================
      // PASO 9: DIBUJO INICIAL
      // ============================================
      dibujoRejilla()
      
      // Dibujar recogibles iniciales
      for(let i = 0; i < recogibles.length; i++){
        recogibles[i].dibuja()
      }
      
      Personaje1.dibuja()
      
      // Actualizar contador inicial
      document.getElementById("posicion").textContent = 
        "Posici贸n: (" + Personaje1.x + ", " + Personaje1.y + ") | Objetos recogidos: 0/" + numeroRecogibles;
      
    </script>
  </body>
</html>
